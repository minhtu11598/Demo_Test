trigger:
  - main

pool:
  name: SelfHostedPool

jobs:
- job: RunRobotFramework
  displayName: Robot Framework on .venv (Windows)
  steps:
    - checkout: self

    - pwsh: |
        python -m pip install --upgrade pip
        if (-not (Test-Path -Path ".venv")) {
          python -m venv .venv
        }
        .\.venv\Scripts\Activate.ps1
        pip install --upgrade pip
        pip install -r requirements.txt
      displayName: 'Setup .venv and install dependencies'

    - pwsh: |
        .\.venv\Scripts\Activate.ps1
        New-Item -ItemType Directory -Force -Path results | Out-Null
        robot --outputdir results --xunit results\xunit.xml tests/
      displayName: 'Run Robot Framework tests'

    - task: PublishTestResults@2
      inputs:
        testResultsFiles: 'results\\xunit.xml'
        testRunTitle: 'Robot Framework Results'
        mergeTestResults: true
        failTaskOnFailedTests: true
      displayName: 'Publish test results'
